<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Browser Theme Dropdown Validation</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .validation-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .browser-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .browser-info h3 {
            margin: 0 0 15px 0;
            color: #1565c0;
        }

        .browser-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .browser-detail {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }

        .test-controls {
            text-align: center;
            margin: 30px 0;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 0 10px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.3s ease;
        }

        .test-results {
            margin-top: 30px;
        }

        .test-category {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .category-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-title {
            font-weight: 600;
            font-size: 1.1em;
            margin: 0;
        }

        .category-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-pass {
            background: #d4edda;
            color: #155724;
        }

        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .status-partial {
            background: #fff3cd;
            color: #856404;
        }

        .test-list {
            padding: 0;
        }

        .test-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-info {
            flex: 1;
        }

        .test-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .test-details {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .test-requirement {
            color: #888;
            font-size: 0.8em;
            font-style: italic;
        }

        .test-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 500;
            min-width: 50px;
            text-align: center;
        }

        .summary-section {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 25px;
            margin-top: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #2196f3;
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #666;
            font-size: 0.9em;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .recommendation-title {
            font-weight: 600;
            color: #d32f2f;
            margin-bottom: 8px;
        }

        .recommendation-text {
            color: #666;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .browser-details {
                grid-template-columns: 1fr;
            }
            
            .test-button {
                display: block;
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="validation-container">
        <div class="header">
            <h1>Cross-Browser Validation</h1>
            <p>Theme Dropdown Positioning Compatibility Testing</p>
        </div>

        <div class="content">
            <div class="browser-info" id="browserInfo">
                <h3>Current Browser Environment</h3>
                <div class="browser-details" id="browserDetails">
                    <!-- Browser details will be populated here -->
                </div>
            </div>

            <div class="test-controls">
                <button class="test-button" id="runAllTests" onclick="runAllValidationTests()">
                    Run All Tests
                </button>
                <button class="test-button" id="runCSSTests" onclick="runCSSTests()">
                    CSS Tests Only
                </button>
                <button class="test-button" id="runJSTests" onclick="runJSTests()">
                    JavaScript Tests Only
                </button>
                <button class="test-button" id="exportResults" onclick="exportResults()" disabled>
                    Export Results
                </button>
            </div>

            <div class="progress-bar hidden" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="loading hidden" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Running cross-browser validation tests...</p>
            </div>

            <div class="test-results hidden" id="testResults">
                <!-- Test results will be populated here -->
            </div>

            <div class="summary-section hidden" id="summarySection">
                <h3>Validation Summary</h3>
                <div class="summary-grid" id="summaryGrid">
                    <!-- Summary cards will be populated here -->
                </div>
                <div class="recommendations hidden" id="recommendations">
                    <h4>Recommendations</h4>
                    <div id="recommendationsList">
                        <!-- Recommendations will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../theme-manager.js"></script>
    <script src="test-cross-browser-compatibility.js"></script>
    <script src="run-cross-browser-tests.js"></script>
    <script src="validate-cross-browser-positioning.js"></script>
    <script>
        let validationResults = null;
        let validator = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            validator = new ThemeDropdownPositioningValidator();
            displayBrowserInfo();
        });

        function displayBrowserInfo() {
            const browserDetails = document.getElementById('browserDetails');
            const info = validator.browserInfo;
            
            browserDetails.innerHTML = `
                <div class="browser-detail">
                    <strong>Browser:</strong> ${info.browser} ${info.version}
                </div>
                <div class="browser-detail">
                    <strong>Engine:</strong> ${info.engine}
                </div>
                <div class="browser-detail">
                    <strong>Legacy Support:</strong> ${info.isLegacy ? 'Required' : 'Not Required'}
                </div>
                <div class="browser-detail">
                    <strong>User Agent:</strong> ${info.userAgent.substring(0, 50)}...
                </div>
            `;
        }

        async function runAllValidationTests() {
            showLoading();
            disableButtons();
            
            try {
                validationResults = await validator.generateValidationReport();
                displayResults(validationResults);
                displaySummary(validationResults);
                document.getElementById('exportResults').disabled = false;
            } catch (error) {
                console.error('Validation failed:', error);
                showError('Validation tests failed: ' + error.message);
            } finally {
                hideLoading();
                enableButtons();
            }
        }

        async function runCSSTests() {
            showLoading();
            disableButtons();
            
            try {
                const cssResults = await validator.testCSSPositioningConsistency();
                displaySingleCategory(cssResults);
            } catch (error) {
                console.error('CSS tests failed:', error);
                showError('CSS tests failed: ' + error.message);
            } finally {
                hideLoading();
                enableButtons();
            }
        }

        async function runJSTests() {
            showLoading();
            disableButtons();
            
            try {
                const jsResults = await validator.testJavaScriptCollisionDetection();
                displaySingleCategory(jsResults);
            } catch (error) {
                console.error('JavaScript tests failed:', error);
                showError('JavaScript tests failed: ' + error.message);
            } finally {
                hideLoading();
                enableButtons();
            }
        }

        function displayResults(results) {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = '';
            testResults.classList.remove('hidden');

            Object.entries(results.testCategories).forEach(([categoryName, category]) => {
                const categoryElement = createCategoryElement(category);
                testResults.appendChild(categoryElement);
            });
        }

        function displaySingleCategory(category) {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = '';
            testResults.classList.remove('hidden');
            
            const categoryElement = createCategoryElement(category);
            testResults.appendChild(categoryElement);
        }

        function createCategoryElement(category) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'test-category';

            const statusClass = category.passed ? 'status-pass' : 'status-fail';
            const statusText = category.passed ? 'PASS' : 'FAIL';

            categoryDiv.innerHTML = `
                <div class="category-header">
                    <h3 class="category-title">${category.category}</h3>
                    <span class="category-status ${statusClass}">${statusText}</span>
                </div>
                <div class="test-list">
                    ${category.results.map(test => `
                        <div class="test-item">
                            <div class="test-info">
                                <div class="test-name">${test.test}</div>
                                <div class="test-details">${test.details}</div>
                                <div class="test-requirement">Requirements: ${test.requirement}</div>
                            </div>
                            <div class="test-status ${test.passed ? 'status-pass' : 'status-fail'}">
                                ${test.passed ? 'PASS' : 'FAIL'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            return categoryDiv;
        }

        function displaySummary(results) {
            const summarySection = document.getElementById('summarySection');
            const summaryGrid = document.getElementById('summaryGrid');
            
            summaryGrid.innerHTML = `
                <div class="summary-card">
                    <div class="summary-number">${results.summary.testsPassed}</div>
                    <div class="summary-label">Tests Passed</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number">${results.summary.totalTests}</div>
                    <div class="summary-label">Total Tests</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number">${results.summary.categoriesPassed}</div>
                    <div class="summary-label">Categories Passed</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number">${results.summary.compatibility}</div>
                    <div class="summary-label">Compatibility Level</div>
                </div>
            `;

            // Display recommendations if any
            if (results.summary.recommendations && results.summary.recommendations.length > 0) {
                const recommendationsDiv = document.getElementById('recommendations');
                const recommendationsList = document.getElementById('recommendationsList');
                
                recommendationsList.innerHTML = results.summary.recommendations.map(rec => `
                    <div class="recommendation-item">
                        <div class="recommendation-title">${rec.category}: ${rec.test}</div>
                        <div class="recommendation-text">
                            <strong>Issue:</strong> ${rec.issue}<br>
                            <strong>Requirement:</strong> ${rec.requirement}<br>
                            <strong>Recommendation:</strong> ${rec.recommendation}
                        </div>
                    </div>
                `).join('');
                
                recommendationsDiv.classList.remove('hidden');
            }

            summarySection.classList.remove('hidden');
        }

        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('testResults').classList.add('hidden');
            document.getElementById('summarySection').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('progressBar').classList.add('hidden');
        }

        function disableButtons() {
            document.querySelectorAll('.test-button').forEach(btn => {
                btn.disabled = true;
            });
        }

        function enableButtons() {
            document.querySelectorAll('.test-button').forEach(btn => {
                btn.disabled = false;
            });
        }

        function showError(message) {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = `
                <div class="test-category">
                    <div class="category-header">
                        <h3 class="category-title">Error</h3>
                        <span class="category-status status-fail">FAIL</span>
                    </div>
                    <div class="test-list">
                        <div class="test-item">
                            <div class="test-info">
                                <div class="test-name">Validation Error</div>
                                <div class="test-details">${message}</div>
                            </div>
                            <div class="test-status status-fail">ERROR</div>
                        </div>
                    </div>
                </div>
            `;
            testResults.classList.remove('hidden');
        }

        function exportResults() {
            if (!validationResults) {
                alert('No results to export. Please run tests first.');
                return;
            }

            const dataStr = JSON.stringify(validationResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `cross-browser-validation-${validationResults.browser.browser}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Auto-run tests if URL parameter is present
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('autorun') === 'true') {
            setTimeout(runAllValidationTests, 1000);
        }
    </script>
</body>
</html>